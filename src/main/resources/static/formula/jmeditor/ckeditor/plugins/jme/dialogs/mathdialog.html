<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<title>JMEditor</title>
<link href="dialog.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class="tabMenu">
	<div class="tabTitle">
		<li>
			常用公式
		</li>
		<li>
			字母
		</li>
		<li>
			符号
		</li>
	</div>
	<div class="tabContent">
		<div class="mathBox">
		</div>
		<div class="mathBox">
		</div>
		<div class="mathBox">
		</div>
	</div>
</div>
<div class="help">
</div>
<div id="mathDiv">
	<p>
		<span id="jme-math" style="padding-left: 10px"></span>
	</p>
	<p>&nbsp;</p>
</div>
<div class="ad">
    <div onclick="generateImg()" style="width: 50px;padding: 5px;color: white;background-color: #65a2ff;border-radius: 3px;float: right;cursor: pointer">生成图片</div>
</div>

<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="html2canvas.min.js"></script>
<script type="text/javascript" src="dialog.js"></script>
</body>
<script>
    $(function(){

    })

    function generateImg() {
        $('#jme-math').css('border','none');
        html2canvas($('#jme-math'),{
            dpi:1000,
            onrendered: function(canvas) {
                convertCanvasToImage(canvas);
            }
        })
    }

    function convertCanvasToImage(canvas) {
        var image = new Image();
        image.src = canvas.toDataURL("image/gif");
        image.style.width = canvas.width/11 + 'px';
        image.style.height = canvas.height/11 + 'px';
        var picture = image.src.replace('data:image/png;base64,','');
        $.ajax({
            cache : true,
            type : "POST",
            url : "/quesBank/demo/upload",
            async: false,
            data : {
                base64: picture
            },
            async : false,
            error : function(request) {
                alert("error")
            },
            success : function(data) {
                image.src = 'http://localhost:8077/quesBank/image/'+data+'.png';
            }
        });
        $('#jme-math').empty();
        $('#jme-math').append(image);
        return image;
    }
</script>
</html>
